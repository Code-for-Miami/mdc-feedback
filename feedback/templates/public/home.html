{% extends "layout.html" %}
{% set active_page = 'Dashboard' %}
{% block content %}

<span id='api-health' class='hidden'>{{ api }}</span>

<div class="remodal" data-remodal-id="modal">

  <button data-remodal-action="close" class="remodal-close"></button>
  <h1 id='status'>Warning!<br>You can't undo this!</h1>
  <p></p>
  <br>
  <button data-remodal-action="confirm" class="remodal-confirm">OK, thanks!</button>

</div>

<section class='row' id='dashboard'>

	<div class='row twelve columns'>
		<h3>Permitting &amp; Inspection Center User Survey Metrics</h3>
	</div>

	<div class='six columns panel first-panel'>

		<!-- the data -->
		<p class='invisible'>{{ dash_obj[0].data.new_reviews }}</p>

		<!-- the content -->
		<div class='headline'>{{ dash_obj[0].title }}<a rel='tipsy' title='this is a tooltip' class='what-is-this u-pull-right tipsy-hook' href='#' id='s-submitted'><img class='' src='static/images/question_bk.png'></a></div>

		<div class='content-container'>
			<canvas id='myChart'></canvas>
		</div>

		<p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>

	</div>

	<div class='three columns panel'>

			<div class='headline'>{{ dash_obj[1].title }}<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='s-rating'><img class='' src='static/images/question_bk.png'></a></div>

			<div class='content-container'>
				<div id='star-rating'>
					<!-- data & display -->
					<p class='invisible'>{{ dash_obj[1].data }}</p>
				</div>
				<p class='label'>Visitors to the PIC are rating their experience as {{ dash_obj[1].data }} out of seven stars.</p>
			</div>

			<p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>

		</div>

	<div class='three columns panel last-panel'>

		<!-- the content -->
		<div class='headline'><a rel='tipsy' title='this is a tooltip' class='what-is-this u-pull-right tipsy-hook' href='#' id='s-type'><img class='' src='static/images/question_bk.png'></a></div>
		<div class='content-container'>
			<canvas id='surveyChart'></canvas>
		</div>

		<p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>
	</div>

  <div class='four columns panel first-panel'>
    <div class='headline'>{{ dash_obj[10].title }}<a rel='tipsy' title='this is a tooltip' class='what-is-this u-pull-right tipsy-hook' href='#' id='s-role'><img class='' src='static/images/question_bk.png'></a></div>
    <div class='content-container'>
			<canvas id='s-role-chart'></canvas>
		</div>
  </div>

  <div class='four columns panel'>
    <div class='headline'>Successful Task Completion<a class='what-is-this u-pull-right tipsy-hook' href='#' id='s-complete'><img class='' src='static/images/question_bk.png'></a></div>
    <div class='content-container'>
			<canvas id='s-complete-chart'></canvas>
		</div>
  </div>

  <div class='four columns panel last-panel'>
    <div class='headline'>{{ dash_obj[13].title }}<a class='what-is-this u-pull-right' href='#' id='s-purpose'><img class='' src='static/images/question_bk.png'></a></div>
    
    <div class='content-container'>
			<canvas id='s-purpose-chart'></canvas>
		</div>
    {{ dash_obj[13].data }}
    <p>Sophia, the equivalent JSON for a pie chart is at <code>#surveypurpose</code>. In each array element, the first digit is a constant for user type, the second is occurance. If it's a full sentence then they wrote it out via typeform.</p>
  </div>

  <div class='four columns panel first-panel'>
    <div class='headline'>Best &amp; Worst Experiences<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='s-best'><img class='' src='static/images/question_bk.png'></a></div>
    <div class='content-container'>
      <div id='bestworst-data'>
        {% for item in resp_obj %}
          {% if item.lang == 'en' %}
            <p>{{ item.bestworst }}</p>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>

  </div>

  <div class='four columns panel'>
    <div class='headline'>Suggested Improvements<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='s-improve'><img class='' src='static/images/question_bk.png'></a></div>
    <div class='content-container'>
      <div id='improvements-data'>
        {% for item in resp_obj %}
          {% if item.lang == 'en' %}
            <p>{{ item.improvement }}</p>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>

  </div>

  <div class='four columns panel last-panel'>

    <div class='headline'>More Comments<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='s-comments'><img class='' src='static/images/question_bk.png'></a></div>
    <div class='content-container'>
      <div id='morecomments-data'>
        {% for item in resp_obj %}
          {% if item.lang == 'en' %}
            <p>{{ item.morecomments }}</p>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <p class='details invisible-button'><a href="{{ url_for('dashboard.survey_detail') }}">View Details</a></p>

  </div>


</section> <!-- close row -->

<section class='row' id='permitting'>

	<div class='row twelve columns'><h3>Permit Metrics</h3></div>

	<div class='twelve columns panel first-panel'>

			<div class='headline'>Permits opened per month<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='p-monthly'><img class='' src='static/images/question_bk.png'></a></div>

			<div class='content-container'>
				<canvas id='openPermits'></canvas>
			</div>

			<p class='hidden details invisible-button'><a href=#>View Details</a></p>

		</div>

	<div class='twelve columns'>

    {{ lifespan_panel(dash_obj[3].title, dash_obj[3].data.val, dash_obj[3].data.waittime, dash_obj[3].data.yoy, false) }}

    {{ lifespan_panel(dash_obj[4].title, dash_obj[4].data.val, dash_obj[4].data.waittime, dash_obj[4].data.yoy, false) }}

    {{ lifespan_panel(dash_obj[5].title, dash_obj[5].data.val, dash_obj[5].data.waittime, dash_obj[5].data.yoy) }}

	</div>

	<div class='twelve columns'>
<!--
    <div class='four columns panel first-panel'>
      <div class='headline'>{{ dash_obj[6].title }}</div>
      <div class='content-container'>
        <p style="font-weight:bold; font-size:250%">
          ${{ '%0.2f'| format(dash_obj[6].data|float) }}
        </p>
      </div>
      <p class='details invisible-button'><a href=#>View Details</a></p>
    </div>

    <div class='four columns panel'>
      <div class='headline'>{{ dash_obj[7].title }}</div>
      <div class='content-container'>
        <p style="font-weight:bold; font-size:250%">
          ${{ '%0.2f'| format(dash_obj[7].data|float) }}
        </p>
      </div>
      <p class='details invisible-button'><a href=#>View Details</a></p>
    </div>

    <div class='four columns panel last-panel'>
      <div class='headline'>{{ dash_obj[8].title }}</div>
      <div class='content-container'>
        <p style="font-weight:bold; font-size:250%">
          ${{ '%0.2f'| format(dash_obj[8].data|float) }}
        </p>
      </div>
      <p class='details invisible-button'><a href=#>View Details</a></p>
    </div>
-->
    
    <div class='four columns panel first-panel'>
      <div class='headline'>{{ dash_obj[9].title }}<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='p-type'><img class='' src='static/images/question_bk.png'></a></div>
      <div class='content-container'>
         <canvas id='permitTypeChart'>
      </div>
      <p class='details invisible-button'><a href=#>View Details</a></p>
    </div>

    <div class='four columns panel'>
      <div class='headline'>{{ dash_obj[11].title }}<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='p-master'><img class='' src='static/images/question_bk.png'></a></div>
      <div class='content-container'>
        <p class="huge bold">{{ '{0:,}'.format(dash_obj[11].data.val) }}</p>
        <p>Versus the same period a year ago:
          {% if dash_obj[11].data.yoy > 0 %}
          <span class='bold green'>Up
          {% else %}
          <span class='bold red'>Down
          {% endif %}
          {{ '%0.2f'| format(dash_obj[11].data.yoy|float) }}%
          </span>
        </p>
      </div>
      <p class='details invisible-button'><a href=#>View Details</a></p>
    </div>

</section> <!-- close row -->

<section class='row' id='regulation'>

	<div class='row twelve columns'><h3>Neighborhood Compliance</h3></div>

	<div class='row twelve columns panel'>

		<div class='headline'>Violations per month<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='v-monthly'><img class='' src='static/images/question_bk.png'></a></div>
		<div class='content-container'>
			<canvas id='violations'></canvas>
		</div>
		<p class='hidden details invisible-button'><a href=#>View Details</a></p>

	</div>

	<div class='row twelve columns'>

		<div class='four columns panel first-panel double-height'>

			<div class='headline'>Violation Locations: Closed Violations<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='v-closed'><img class='' src='static/images/question_bk.png'></a></div>
			<div class='content-container'>
				<div id='leaflet'></div>
			</div>
			<p class='hidden details invisible-button'><a href=#>View Details</a></p>
		</div>

		<div class='four columns panel double-height'>

			<div class='headline'>Violation Locations: Locked Violations<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='v-locked'><img class='' src='static/images/question_bk.png'></a></div>

			<div class='content-container'>
				<div id='leaflet-open'></div>
			</div>
			<p class='hidden details invisible-button'><a href=#>View Details</a></p>
		</div>

		<div class='four columns panel last-panel double-height'>

			<div class='headline'>Violation Locations: Locations with Liens<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='v-liens'><img class='' src='static/images/question_bk.png'></a></div>
			<div class='content-container'>
				<div id='leaflet-lein'></div>
			</div>
			<p class='hidden details invisible-button'><a href=#>View Details</a></p>
		</div>

	</div>

	<div class='row twelve columns panel double-height'>

			<div class='headline'>Top 20 Violations by Type<a rel='tipsy' title='this is a tooltip' class='what-is-this   u-pull-right tipsy-hook' href='#' id='v-type'><img class='' src='static/images/question_bk.png'></a></div>
			<div class='content-container'>
				<canvas id='viotype'></canvas>
			</div>
			<p class='details invisible-button'><a href="{{ url_for('dashboard.violations_detail') }}">View Complete Dataset</a></p>

		</div>
</section> <!-- close row -->

{% endblock %}

{% macro lifespan_panel(title='', val=0, waittime=0, yoy=0, lastpanel=True) -%}

    <div class='four columns panel{% if lastpanel==True %} last-panel{% endif %}'>

      <div class='headline'>{{ title }}<a class='what-is-this u-pull-right' href='#'><img class='' src='static/images/question_bk.png'></a></div>
      
      <div class='content-container vertical-center-35'>

        <p class='huge bold'>{{ val }} days</p>
        <p>Versus previous 30 days:
          {% if yoy > 0 %}
          <span class='bold red'>Up
          {% else %}
          <span class='bold green'>Down
          {% endif %}
          {{ '%0.2f'| format(yoy|float) }}%
          </span>
        </p>
      </div>
      <p class='hidden details invisible-button'><a href=#>View Details</a></p>
    </div>
{%- endmacro %}
