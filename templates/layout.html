<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <!--[if IE]><![endif]-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title></title>

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <meta name="viewport" content="width=device-width">

  <!-- !CSS -->
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/normalize.css') }}" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/skeleton.css') }}" />
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}" />

</head>
<!-- !Body -->
<body>

  <header>


    <div class='u-pull-right four columns'>

      {% if current_user.email %}
      <a class="navbar-link" href="{{ url_for('profile') }}">Profile</a>, <a class="navbar-link js-signout" href="#"><i class="fa fa-sign-out"></i> Sign Out</a>
      {% else %}
      <a href="#" class="navbar-link js-signin">Login</a>
      {% endif %}

    </div>

  </header>

  <div id="container">

{% block content %}{% endblock %}


  </div><!--!/#container -->

  <footer>
  </footer><!-- /footer -->

  <!-- !Javascript - at the bottom for fast page loading -->
  <!-- Grab Google CDN's jQuery. -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://login.persona.org/include.js"></script>
<script>
{% if current_user.is_anonymous() or not current_user %}
var currentUser = null;
{% else %}
var currentUser = {{current_user.email|tojson|safe}};
{% endif %}
navigator.id.watch({
  loggedInUser: currentUser,
  onlogin: function(assertion) {
    // A user has logged in! Here you need to:
    // 1. Send the assertion to your backend for verification and to create a session.
    // 2. Update your UI.
    $.ajax({ /* <-- This example uses jQuery, but you can use whatever you'd like */
      type: 'POST',
      url: '{{ url_for("auth") }}', // This is a URL on your website.
      data: {assertion: assertion},
      success: function(res, status, xhr) {
        // window.location.href = res.split('thispage')[0];
      },
      error: function(xhr, status, err) {
        alert("Login failure: " + err);
      }
    });
  },
  onlogout: function() {
    // A user has logged out! Here you need to:
    // Tear down the user's session by redirecting the user or making a call to your backend.
    // Also, make sure loggedInUser will get set to null on the next page load.
    // (That's a literal JavaScript null. Not false, 0, or undefined. null.)
    $.ajax({
      type: 'POST',
      url: '{{ url_for("logout") }}', // This is a URL on your website.
      success: function(res, status, xhr) { window.location.reload(); },
      error: function(xhr, status, err) { alert("Logout failure: " + err); }
    });
  }
});
var signinLink = $('.js-signin');
if (signinLink) {
  signinLink.on('click', function() {
    navigator.id.request();
  });
}
var signoutLink = $('.js-signout');
if (signoutLink) {
  signoutLink.on('click', function() {
    navigator.id.logout();
  });
}
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-60542627-3', 'auto');
ga('send', 'pageview');
</script>
<!-- end scripts -->

</body>
</html>
